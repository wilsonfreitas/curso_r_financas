<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 5 Análise de Risco | Tópicos de Finanças com R</title>
  <meta name="description" content="Este livro é sobre programação em R aplicada a finanças. Como o R pode ser utilizado no tratamento de dados financeiros, nas análises financeiras e nos cálculos, modelos e simulações de investimentos." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 5 Análise de Risco | Tópicos de Finanças com R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Este livro é sobre programação em R aplicada a finanças. Como o R pode ser utilizado no tratamento de dados financeiros, nas análises financeiras e nos cálculos, modelos e simulações de investimentos." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 5 Análise de Risco | Tópicos de Finanças com R" />
  
  <meta name="twitter:description" content="Este livro é sobre programação em R aplicada a finanças. Como o R pode ser utilizado no tratamento de dados financeiros, nas análises financeiras e nos cálculos, modelos e simulações de investimentos." />
  

<meta name="author" content="Sillas Gonzaga e Wilson Freitas" />


<meta name="date" content="2020-11-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="returns.html"/>
<link rel="next" href="análise-de-carteiras.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Tópicos de Finanças com R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Boas-vindas</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sobre-os-instrutores"><i class="fa fa-check"></i>Sobre os instrutores</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Primeiros passos com R</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#o-que-é-r-e-por-que-devo-aprendê-lo"><i class="fa fa-check"></i><b>1.1</b> O que é R e por que devo aprendê-lo?</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#introdução-ao-rstudio"><i class="fa fa-check"></i><b>1.2</b> Introdução ao Rstudio</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#operações-aritméticas"><i class="fa fa-check"></i><b>1.3</b> Operações aritméticas</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#criação-de-variáveis-e-objetos"><i class="fa fa-check"></i><b>1.4</b> Criação de variáveis e objetos</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#estruturas-de-dados"><i class="fa fa-check"></i><b>1.5</b> Estruturas de dados</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#operadores-de-comparação"><i class="fa fa-check"></i><b>1.6</b> Operadores de comparação</a></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#conversões-de-tipos-de-variáveis"><i class="fa fa-check"></i><b>1.7</b> Conversões de tipos de variáveis</a></li>
<li class="chapter" data-level="1.8" data-path="intro.html"><a href="intro.html#vetores"><i class="fa fa-check"></i><b>1.8</b> Vetores</a></li>
<li class="chapter" data-level="1.9" data-path="intro.html"><a href="intro.html#matrizes"><i class="fa fa-check"></i><b>1.9</b> Matrizes</a></li>
<li class="chapter" data-level="1.10" data-path="intro.html"><a href="intro.html#data-frames"><i class="fa fa-check"></i><b>1.10</b> Data frames</a></li>
<li class="chapter" data-level="1.11" data-path="intro.html"><a href="intro.html#funções"><i class="fa fa-check"></i><b>1.11</b> Funções</a></li>
<li class="chapter" data-level="1.12" data-path="intro.html"><a href="intro.html#pacotes"><i class="fa fa-check"></i><b>1.12</b> Pacotes</a></li>
<li class="chapter" data-level="1.13" data-path="intro.html"><a href="intro.html#exercícios"><i class="fa fa-check"></i><b>1.13</b> Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="novos-passos-com-r-part2.html"><a href="novos-passos-com-r-part2.html"><i class="fa fa-check"></i><b>2</b> Novos passos com R {part2}</a><ul>
<li class="chapter" data-level="2.1" data-path="novos-passos-com-r-part2.html"><a href="novos-passos-com-r-part2.html#leitura-de-arquivos-csv"><i class="fa fa-check"></i><b>2.1</b> Leitura de arquivos csv</a></li>
<li class="chapter" data-level="2.2" data-path="novos-passos-com-r-part2.html"><a href="novos-passos-com-r-part2.html#gráficos-com-ggplot2"><i class="fa fa-check"></i><b>2.2</b> Gráficos com ggplot2</a></li>
<li class="chapter" data-level="2.3" data-path="novos-passos-com-r-part2.html"><a href="novos-passos-com-r-part2.html#trabalhando-com-datas"><i class="fa fa-check"></i><b>2.3</b> Trabalhando com datas</a></li>
<li class="chapter" data-level="2.4" data-path="novos-passos-com-r-part2.html"><a href="novos-passos-com-r-part2.html#parsear-datas-e-horários"><i class="fa fa-check"></i><b>2.4</b> ‘Parsear’ datas e horários</a></li>
<li class="chapter" data-level="2.5" data-path="novos-passos-com-r-part2.html"><a href="novos-passos-com-r-part2.html#extrair-componentes-de-uma-data"><i class="fa fa-check"></i><b>2.5</b> Extrair componentes de uma data</a></li>
<li class="chapter" data-level="2.6" data-path="novos-passos-com-r-part2.html"><a href="novos-passos-com-r-part2.html#operações-matemáticas-com-datas"><i class="fa fa-check"></i><b>2.6</b> Operações matemáticas com datas</a></li>
<li class="chapter" data-level="2.7" data-path="novos-passos-com-r-part2.html"><a href="novos-passos-com-r-part2.html#if-else"><i class="fa fa-check"></i><b>2.7</b> If-else</a></li>
<li class="chapter" data-level="2.8" data-path="novos-passos-com-r-part2.html"><a href="novos-passos-com-r-part2.html#loops"><i class="fa fa-check"></i><b>2.8</b> Loops</a></li>
<li class="chapter" data-level="2.9" data-path="novos-passos-com-r-part2.html"><a href="novos-passos-com-r-part2.html#criado-suas-próprias-funções"><i class="fa fa-check"></i><b>2.9</b> Criado suas próprias funções</a></li>
<li class="chapter" data-level="2.10" data-path="novos-passos-com-r-part2.html"><a href="novos-passos-com-r-part2.html#listas"><i class="fa fa-check"></i><b>2.10</b> Listas</a></li>
<li class="chapter" data-level="2.11" data-path="novos-passos-com-r-part2.html"><a href="novos-passos-com-r-part2.html#purrrmap"><i class="fa fa-check"></i><b>2.11</b> purrr::map</a></li>
<li class="chapter" data-level="2.12" data-path="novos-passos-com-r-part2.html"><a href="novos-passos-com-r-part2.html#case-1"><i class="fa fa-check"></i><b>2.12</b> Case 1</a></li>
<li class="chapter" data-level="2.13" data-path="novos-passos-com-r-part2.html"><a href="novos-passos-com-r-part2.html#case-2"><i class="fa fa-check"></i><b>2.13</b> Case 2</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="fontes-de-dados-financeiros.html"><a href="fontes-de-dados-financeiros.html"><i class="fa fa-check"></i><b>3</b> Fontes de dados financeiros</a><ul>
<li class="chapter" data-level="3.1" data-path="intro.html"><a href="intro.html#pacotes"><i class="fa fa-check"></i><b>3.1</b> Pacotes</a></li>
<li class="chapter" data-level="3.2" data-path="fontes-de-dados-financeiros.html"><a href="fontes-de-dados-financeiros.html#manipulação-de-dados-com-xts-e-quantmod"><i class="fa fa-check"></i><b>3.2</b> Manipulação de dados com xts e quantmod</a></li>
<li class="chapter" data-level="3.3" data-path="fontes-de-dados-financeiros.html"><a href="fontes-de-dados-financeiros.html#helpers-do-quantmod-cl-op-hi-lo"><i class="fa fa-check"></i><b>3.3</b> Helpers do quantmod: Cl, Op, Hi, Lo</a></li>
<li class="chapter" data-level="3.4" data-path="fontes-de-dados-financeiros.html"><a href="fontes-de-dados-financeiros.html#funções-de-gráficos-xts"><i class="fa fa-check"></i><b>3.4</b> Funções de gráficos xts</a></li>
<li class="chapter" data-level="3.5" data-path="fontes-de-dados-financeiros.html"><a href="fontes-de-dados-financeiros.html#juntar-múltiplas-séries-temporais-fazer-merge-das-séries-de-fechamento."><i class="fa fa-check"></i><b>3.5</b> Juntar múltiplas séries temporais: fazer merge das séries de fechamento.</a></li>
<li class="chapter" data-level="3.6" data-path="fontes-de-dados-financeiros.html"><a href="fontes-de-dados-financeiros.html#case"><i class="fa fa-check"></i><b>3.6</b> Case</a></li>
</ul></li>
<li class="part"><span><b>I Aplicações</b></span></li>
<li class="chapter" data-level="4" data-path="returns.html"><a href="returns.html"><i class="fa fa-check"></i><b>4</b> Análise de Retornos</a><ul>
<li class="chapter" data-level="4.1" data-path="returns.html"><a href="returns.html#retornos-simples"><i class="fa fa-check"></i><b>4.1</b> Retornos simples</a></li>
<li class="chapter" data-level="4.2" data-path="returns.html"><a href="returns.html#retornos-logaritimicos"><i class="fa fa-check"></i><b>4.2</b> Retornos logaritimicos</a></li>
<li class="chapter" data-level="4.3" data-path="returns.html"><a href="returns.html#s:equivalent-returns"><i class="fa fa-check"></i><b>4.3</b> Relação entre os retornos simples e logaritimicos</a></li>
<li class="chapter" data-level="4.4" data-path="returns.html"><a href="returns.html#porque-formas-diferentes-de-calcular-os-retornos"><i class="fa fa-check"></i><b>4.4</b> Porque formas diferentes de calcular os retornos?</a></li>
<li class="chapter" data-level="4.5" data-path="returns.html"><a href="returns.html#retorno-esperado"><i class="fa fa-check"></i><b>4.5</b> Retorno esperado</a></li>
<li class="chapter" data-level="4.6" data-path="returns.html"><a href="returns.html#risco-esperado"><i class="fa fa-check"></i><b>4.6</b> Risco esperado</a></li>
<li class="chapter" data-level="4.7" data-path="returns.html"><a href="returns.html#exercícios---análise-de-retornos"><i class="fa fa-check"></i><b>4.7</b> Exercícios - Análise de Retornos</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="análise-de-risco.html"><a href="análise-de-risco.html"><i class="fa fa-check"></i><b>5</b> Análise de Risco</a><ul>
<li class="chapter" data-level="5.1" data-path="análise-de-risco.html"><a href="análise-de-risco.html#visualização-dos-retornos"><i class="fa fa-check"></i><b>5.1</b> Visualização dos Retornos</a></li>
<li class="chapter" data-level="5.2" data-path="análise-de-risco.html"><a href="análise-de-risco.html#análise-estatística-dos-retornos"><i class="fa fa-check"></i><b>5.2</b> Análise Estatística dos Retornos</a></li>
<li class="chapter" data-level="5.3" data-path="análise-de-risco.html"><a href="análise-de-risco.html#medidas-de-risco"><i class="fa fa-check"></i><b>5.3</b> Medidas de Risco</a></li>
<li class="chapter" data-level="5.4" data-path="análise-de-risco.html"><a href="análise-de-risco.html#análise-em-janela-móvel"><i class="fa fa-check"></i><b>5.4</b> Análise em Janela Móvel</a></li>
<li class="chapter" data-level="5.5" data-path="análise-de-risco.html"><a href="análise-de-risco.html#túnel-de-volatilidade"><i class="fa fa-check"></i><b>5.5</b> Túnel de Volatilidade</a></li>
<li class="chapter" data-level="5.6" data-path="análise-de-risco.html"><a href="análise-de-risco.html#comparando-ativos"><i class="fa fa-check"></i><b>5.6</b> Comparando Ativos</a></li>
<li class="chapter" data-level="5.7" data-path="análise-de-risco.html"><a href="análise-de-risco.html#exercícios---análise-de-risco"><i class="fa fa-check"></i><b>5.7</b> Exercícios - Análise de Risco</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="análise-de-carteiras.html"><a href="análise-de-carteiras.html"><i class="fa fa-check"></i><b>6</b> Análise de Carteiras</a><ul>
<li class="chapter" data-level="6.1" data-path="análise-de-carteiras.html"><a href="análise-de-carteiras.html#carteira-de-ativos"><i class="fa fa-check"></i><b>6.1</b> Carteira de ativos</a></li>
<li class="chapter" data-level="6.2" data-path="análise-de-carteiras.html"><a href="análise-de-carteiras.html#carteira-com-2-ativos"><i class="fa fa-check"></i><b>6.2</b> Carteira com 2 ativos</a></li>
<li class="chapter" data-level="6.3" data-path="análise-de-carteiras.html"><a href="análise-de-carteiras.html#montando-uma-carteira"><i class="fa fa-check"></i><b>6.3</b> Montando uma carteira</a></li>
<li class="chapter" data-level="6.4" data-path="análise-de-carteiras.html"><a href="análise-de-carteiras.html#rebalanceamento-da-carteira"><i class="fa fa-check"></i><b>6.4</b> Rebalanceamento da carteira</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tópicos de Finanças com R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="análise-de-risco" class="section level1">
<h1><span class="header-section-number">Capítulo 5</span> Análise de Risco</h1>
<p>Acabamos de ver como trabalhar com retornos financeiros, qual a diferença entre retornos simples e log-retornos, porque é mais comum trabalharmos com os log-retornos e como calcular o retorno esperado e a volatilidade de ativos financeiros.
Dando continuidade vamos entender o que fazer com tudo isso.
Como fazer a análise de risco de ativos e como comparar ativos financeiros, levando em consideração o seu retorno esperado e a sua volatilidade (análise de risco e retorno).</p>
<p>Vamos ver que, em geral, o retorno e o risco costumam caminhar juntos de forma que para obter maiores retornos em investimentos devemos estar dispostos a assumir mais risco.
Se algum investimento promete maior retorno com menos risco, tome cuidado, pode ser uma fraude!</p>
<div id="visualização-dos-retornos" class="section level2">
<h2><span class="header-section-number">5.1</span> Visualização dos Retornos</h2>
<p>No Capítulo <a href="returns.html#returns">4</a> vimos como calcular os retornos a partir da série de preços de um ativo financeiro, assim como calcular o seu retorno esperado e a sua volatilidade.</p>
<p>Mas um ponto muito importante na análise de ativos financeiro é a observação dos dados.
Dessa maneira, vamos dar uma passo para trás e introduzir uma análise qualitativa dos retornos que envolve a visualização dos log-retornos.</p>
<p>Vamos começar obtendo a série de cotação de fechamento do índice IBOVESPA no período de 10 anos de 2010 a 2019.
Para obter a série do índice vamos utiliza a função <code>getSymbols</code> do pacote <code>quantmod</code>.
O símbolo do IBOVESPA é <code>^BVSP</code>.</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="análise-de-risco.html#cb420-1"></a>IBOVESPA &lt;-<span class="st"> </span><span class="kw">getSymbols</span>(<span class="st">&quot;^BVSP&quot;</span>,</span>
<span id="cb420-2"><a href="análise-de-risco.html#cb420-2"></a>                       <span class="dt">from =</span> <span class="st">&quot;2009-12-31&quot;</span>,</span>
<span id="cb420-3"><a href="análise-de-risco.html#cb420-3"></a>                       <span class="dt">to =</span> <span class="st">&quot;2019-12-31&quot;</span>,</span>
<span id="cb420-4"><a href="análise-de-risco.html#cb420-4"></a>                       <span class="dt">auto.assign =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>Como é fundamental <strong>ver</strong> os dados com os quais se está trabalhando, vamos visualizar a série do índice, pegando a série de cotações de fechamento.</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="análise-de-risco.html#cb421-1"></a>IBOVESPA <span class="op">%&gt;%</span></span>
<span id="cb421-2"><a href="análise-de-risco.html#cb421-2"></a><span class="st">  </span><span class="kw">Cl</span>() <span class="op">%&gt;%</span></span>
<span id="cb421-3"><a href="análise-de-risco.html#cb421-3"></a><span class="st">  </span><span class="kw">autoplot</span>()</span></code></pre></div>
<p><img src="curso_r_financas_files/figure-html/unnamed-chunk-90-1.png" width="672" /></p>
<p>O que observamos?</p>
<ul>
<li>De 2010 até 2016, aproximadamente há uma tendência de queda.</li>
<li>A partir de 2016 há uma forte tendência de alta.</li>
</ul>
<p>Agora vamos calcular os retornos das cotações de fechamento:</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="análise-de-risco.html#cb422-1"></a>IBOVESPA_rets &lt;-<span class="st"> </span>IBOVESPA <span class="op">%&gt;%</span></span>
<span id="cb422-2"><a href="análise-de-risco.html#cb422-2"></a><span class="st">  </span><span class="kw">Cl</span>() <span class="op">%&gt;%</span></span>
<span id="cb422-3"><a href="análise-de-risco.html#cb422-3"></a><span class="st">  </span><span class="kw">log</span>() <span class="op">%&gt;%</span></span>
<span id="cb422-4"><a href="análise-de-risco.html#cb422-4"></a><span class="st">  </span><span class="kw">diff</span>()</span></code></pre></div>
<p>Vamos visualizar os retornos agora:</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="análise-de-risco.html#cb423-1"></a>IBOVESPA_rets <span class="op">%&gt;%</span></span>
<span id="cb423-2"><a href="análise-de-risco.html#cb423-2"></a><span class="st">  </span><span class="kw">autoplot</span>()</span></code></pre></div>
<p><img src="curso_r_financas_files/figure-html/unnamed-chunk-92-1.png" width="672" /></p>
<p>O que observamos?</p>
<ul>
<li>Oscilações tanto positivas quanto negativas</li>
<li>Sem tendência</li>
<li>Pontos extremos</li>
<li>Quando temos pontos extremos podemos perceber uma aglomeração nesse sentido</li>
</ul>
<blockquote>
<p>Observando os retornos do índice temos um sobe e desce errático, <strong>sem tendência</strong>, bem diferente da série do índice que claramente apresenta tendência.
Essa ausência de tendência é uma característica fundamental da série de retornos.</p>
</blockquote>
<p>Na próxima seção vamos introduzir a análise estatística dos retornos e como ela pode nos ajudar na caracterização dessa variável.</p>
</div>
<div id="análise-estatística-dos-retornos" class="section level2">
<h2><span class="header-section-number">5.2</span> Análise Estatística dos Retornos</h2>
<p>Uma forma de descrever os retornos é assumir que podem ser descritos como uma <strong>variável aleatória</strong> e assim usar a teoria da probabilidade para descrever o seu comportamento.
A variável <code>IBOVESPA_rets</code> que tem a série de retornos é uma realização dessa variável aleatória, a qual vamos chamar de amostra aleatória.
A partir dessa amostra realizamos a <strong>análise estatística dos retornos</strong>, onde vamos apresentar algumas métricas úteis para descrever a variável aleatória, e muito úteis para comparar diferentes varíaveis aleatórias.
Pois se consideramos os retornos do IBOVESPA uma variável aleatória, os retornos no índice S&amp;P 500, por exemplo, também podem ser descritos como uma variável aleatória só que uma diferente do IBOVESPA.</p>
<p>A descrição matemática de uma variável aleatória não será vista aqui, não é o objetivo.
Entretanto, vamos apresentar algumas avaliações qualitativas que permitam caracterizar a variável aleatória e nos suportem na avaliação de risco dos ativos.</p>
<div id="estatísticas-descritivas" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Estatísticas Descritivas</h3>
<p>São <em>medidas resumo</em> que são calculadas para qualquer <strong>amostra aleatória</strong>.
São úteis para caracterizar e entender a amostra aleatória, assim como comparar variáveis aleatórias diferentes.</p>
<p>São exemplos de estatísticas descritivas para uma amostra aleatória: a média, a mediana, alguns quartis e valores de mínimo e máximo.</p>
<p>No R a função <code>summary</code> provê algumas estatísticas descritivas da nossa série de retornos do IBOVESPA</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="análise-de-risco.html#cb424-1"></a><span class="kw">summary</span>(<span class="kw">coredata</span>(IBOVESPA_rets))</span></code></pre></div>
<pre><code>##    BVSP.Close       
##  Min.   :-0.092107  
##  1st Qu.:-0.008163  
##  Median : 0.000262  
##  Mean   : 0.000146  
##  3rd Qu.: 0.008523  
##  Max.   : 0.063887  
##  NA&#39;s   :23</code></pre>
<p>Note que estas medidas ajudam a entender como a amostra está distribuída.
Conhecendo os pontos de mínimo e máximo temos o intervalo de cobertura da amostra.
No caso dos retornos diários do IBOVESPA temos um mínimo de -0,092107 e um máximo de 0,063887.
Com isso podemos concluir que em um intervalo de 10 anos o pior retorno diário para o IBOVESPA foi de -9% e o seu maior retorno foi de 6%.
Como os retornos são calculados com base no preço de fechamento, temos que eventualmente ao longo de um dia de negociação o índice pode ter sofrido uma queda superior a 9%, contudo, para o fechamento este é o pior resultado no período.
O primeiro quartil, que marca 25% dos dados da amostra, está em -0,008163 indicando que um quarto dos dados da amostra está abaixo de -0,8%, de outra forma temos que 75% dos dados está acima de -0,8%, ou seja, em 75% dos dias da amostra os retornos foram superiores a -0,8%.
A mediana é ligeiramente superior a média, na verdade quase o dobro, isso pode ser uma indicação de qua amostra é negativamente assimétrica, pois a mediana é o <em>meio</em> da amostra e a média o seu ponto médio.
Todavia, os valores aqui de média e mediana são muito próximos de zero, dessa maneira, a análise persiste, mas eventualmente esse efeito não seja significativo.</p>
<p>Além dessas medidas de posição, há também as medidas de dispersão.
Já vimos no Capítulo <a href="returns.html#returns">4</a> a variância e o desvio padrão (volatilidade)</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="análise-de-risco.html#cb426-1"></a><span class="kw">var</span>(IBOVESPA_rets <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.numeric</span>(), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 0.0001973679</code></pre>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="análise-de-risco.html#cb428-1"></a><span class="kw">sd</span>(IBOVESPA_rets, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 0.01404877</code></pre>
<p>Mas temos também a assimetria (<em>skewness</em>), que indica o quão simétrica é a amostra em torno da média.
Uma assimetria zero indica que a amostra é simétrica, a assimetria positiva indica uma amostra com maior peso para valores acima da média e assimetria negativa o oposto.</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="análise-de-risco.html#cb430-1"></a><span class="kw">skewness</span>(IBOVESPA_rets, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] -0.1643848</code></pre>
<p>Conforme falamos na análise da mediana, a amostra apresentava uma assimetria negativa, e o skewness confirma essa hipótese.</p>
<p>Outra medida interessante é a curtose (<em>kurtosis</em>).
A curtose é sempre positiva e quanto maior a curtose maior a probabilidade de que eventos extremos ocorram.
Como balisador usamos a curtose da distribuição Normal (Gaussiana) que é uma distribuição muito importante e aparece em diversos fenômenos.
Para a distribuição Normal e curtose é 3, dessa maneira, se a amostra apresenta uma curtose maior que 3 ela tem probabilidade de eventos extremos maior do que uma distribuição Normal.</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="análise-de-risco.html#cb432-1"></a><span class="kw">kurtosis</span>(IBOVESPA_rets, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, <span class="dt">method =</span> <span class="st">&quot;moment&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 4.945592</code></pre>
<p>Como vemos os retornos do IBOVESPA apresentam uma curtose maior do que 3, logo, há uma probabilidade de eventos extremos maior do que uma distribuição Normal.
Isso não é necessariamente bom ou ruim, porque os eventos extremos podem ser positivos ou negativos e apesar dos retornos extremos negativos serem indesejados, os retornos extremos positivos são altamente desejáveis.</p>
<p>Para efeito de comparação, vamos calcular as estatísticas descritivas para uma amostra aleatória Normal com média e variância dos retornos do IBOVESPA.</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="análise-de-risco.html#cb434-1"></a><span class="co"># aprox. 10 anos</span></span>
<span id="cb434-2"><a href="análise-de-risco.html#cb434-2"></a>x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">2500</span>,</span>
<span id="cb434-3"><a href="análise-de-risco.html#cb434-3"></a>           <span class="dt">mean =</span> <span class="kw">mean</span>(IBOVESPA_rets, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb434-4"><a href="análise-de-risco.html#cb434-4"></a>           <span class="dt">sd =</span> <span class="kw">sd</span>(IBOVESPA_rets, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb434-5"><a href="análise-de-risco.html#cb434-5"></a><span class="kw">c</span>(</span>
<span id="cb434-6"><a href="análise-de-risco.html#cb434-6"></a>  <span class="kw">summary</span>(x),</span>
<span id="cb434-7"><a href="análise-de-risco.html#cb434-7"></a>  <span class="dt">skewness =</span> <span class="kw">skewness</span>(x),</span>
<span id="cb434-8"><a href="análise-de-risco.html#cb434-8"></a>  <span class="dt">kurtosis =</span> <span class="kw">kurtosis</span>(x, <span class="dt">method =</span> <span class="st">&quot;moment&quot;</span>)</span>
<span id="cb434-9"><a href="análise-de-risco.html#cb434-9"></a>)</span></code></pre></div>
<pre><code>##          Min.       1st Qu.        Median          Mean       3rd Qu. 
## -4.251461e-02 -9.092009e-03 -2.708750e-04 -1.016945e-05  9.141816e-03 
##          Max.      skewness      kurtosis 
##  5.111218e-02  9.684062e-02  2.987328e+00</code></pre>
<p>Note que na amostra Normal os pontos de mínimo e máximo são bem menores que na distribuição de retornos do IBOVESPA, esse é um efeito que pode ser explicado, pela curtose mais elevada da distribuição de retornos.</p>
</div>
<div id="histograma" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Histograma</h3>
<p>Um histograma é um gráfico que representa a distribuição construida a partir da amostra aleatória, é um gráfico da distribuição amostral.</p>
<p>No <a href="https://cran.r-project.org/package=PerformanceAnalytics">PerformanceAnalytics</a> temos a função <code>chart.Histogram</code>.</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="análise-de-risco.html#cb436-1"></a>IBOVESPA_rets <span class="op">%&gt;%</span></span>
<span id="cb436-2"><a href="análise-de-risco.html#cb436-2"></a><span class="st">  </span><span class="kw">chart.Histogram</span>(<span class="dt">breaks =</span> <span class="dv">50</span>,</span>
<span id="cb436-3"><a href="análise-de-risco.html#cb436-3"></a>                  <span class="dt">main =</span> <span class="st">&quot;Histograma de retornos do IBOVESPA&quot;</span>,</span>
<span id="cb436-4"><a href="análise-de-risco.html#cb436-4"></a>                  <span class="dt">show.outliers =</span> <span class="ot">TRUE</span>,</span>
<span id="cb436-5"><a href="análise-de-risco.html#cb436-5"></a>                  <span class="dt">methods =</span> <span class="st">&quot;add.normal&quot;</span>, <span class="dt">lwd =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="curso_r_financas_files/figure-html/unnamed-chunk-98-1.png" width="672" /></p>
<p>O que observamos?</p>
<ul>
<li>Pico em torno de zero, região mais provável ou de maior frequência.</li>
<li>Pontos distantes do zero, positivos e negativos, indicando a ocorrência de eventos extremos</li>
<li>No geral, tipicamente simétrico, se ignorarmos os extremos.</li>
</ul>
<p>A análise estatística dos retornos é fundamental pra entendermos a amostra e fazer qualquer tratamento nos dados para corrigir distorções que eventualmente surjam nos dados.
É fundamental visualizar os dados, calcular as estatísticas descritivas e as estatísticas de dispersão e visualizar o histograma dos retornos, se comparar com a distribuição Normal, melhor ainda.
Esse processo contribui para aumentar a sensibilidade com os dados e o senso crítico ao inicial uma análise.</p>
</div>
</div>
<div id="medidas-de-risco" class="section level2">
<h2><span class="header-section-number">5.3</span> Medidas de Risco</h2>
<p>Vamos introduzir aqui algumas medidas de risco e utilizar alguns exemplos com o ativo BOVA11, que é um ETF (fundo negociado em bolsa) que reproduz o retorno do índice IBOVESPA.
O BOVA11 não é exatamente, na vírgula, o índice IBOVESPA, mas é muito próximo do índice.
Vamos criar as séries de preços do BOVA11, de retornos diários, de preços mensais e retornos mensais.</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="análise-de-risco.html#cb437-1"></a>BOVA11 &lt;-<span class="st"> </span><span class="kw">getSymbols</span>(<span class="st">&quot;BOVA11.SA&quot;</span>,</span>
<span id="cb437-2"><a href="análise-de-risco.html#cb437-2"></a>                     <span class="dt">to =</span> <span class="st">&quot;2019-12-31&quot;</span>,</span>
<span id="cb437-3"><a href="análise-de-risco.html#cb437-3"></a>                     <span class="dt">auto.assign =</span> <span class="ot">FALSE</span>)</span>
<span id="cb437-4"><a href="análise-de-risco.html#cb437-4"></a>BOVA11_rets &lt;-<span class="st"> </span>BOVA11 <span class="op">%&gt;%</span></span>
<span id="cb437-5"><a href="análise-de-risco.html#cb437-5"></a><span class="st">  </span><span class="kw">Cl</span>() <span class="op">%&gt;%</span></span>
<span id="cb437-6"><a href="análise-de-risco.html#cb437-6"></a><span class="st">  </span><span class="kw">log</span>() <span class="op">%&gt;%</span></span>
<span id="cb437-7"><a href="análise-de-risco.html#cb437-7"></a><span class="st">  </span><span class="kw">diff</span>()</span>
<span id="cb437-8"><a href="análise-de-risco.html#cb437-8"></a>BOVA11_monthly &lt;-<span class="st"> </span>BOVA11 <span class="op">%&gt;%</span></span>
<span id="cb437-9"><a href="análise-de-risco.html#cb437-9"></a><span class="st">  </span><span class="kw">Ad</span>() <span class="op">%&gt;%</span></span>
<span id="cb437-10"><a href="análise-de-risco.html#cb437-10"></a><span class="st">  </span><span class="kw">to.period</span>()</span>
<span id="cb437-11"><a href="análise-de-risco.html#cb437-11"></a>BOVA11_monthly_rets &lt;-<span class="st"> </span>BOVA11_monthly <span class="op">%&gt;%</span></span>
<span id="cb437-12"><a href="análise-de-risco.html#cb437-12"></a><span class="st">  </span><span class="kw">Cl</span>() <span class="op">%&gt;%</span></span>
<span id="cb437-13"><a href="análise-de-risco.html#cb437-13"></a><span class="st">  </span><span class="kw">log</span>() <span class="op">%&gt;%</span></span>
<span id="cb437-14"><a href="análise-de-risco.html#cb437-14"></a><span class="st">  </span><span class="kw">diff</span>()</span></code></pre></div>
<p>Vamos considerar um cenário onde eu tenho uma carteira com 1000 ações do BOVA11.
A série de BOVA11 termina em dez/2019, e a cotação de fechamento é R$ 111,23, logo o patrimônio da carteira é R$ 111.230,00.</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="análise-de-risco.html#cb438-1"></a>BOVA11 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">last</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">Cl</span>()</span></code></pre></div>
<pre><code>##            BOVA11.SA.Close
## 2019-12-30          111.23</code></pre>
<p>Dessa forma e para começarmos a discutir sobre as medidas de risco vou colocar algumas perguntas que precisam ser respondidas.</p>
<ul>
<li>Quanto eu (investidor) posso perder, em valor, para uma oscilação extrema do BOVA11 considerando o período de 1 mês?</li>
<li>Qual a probabilidade de que eu sofra uma perda de mais de 5% em 1 mês?</li>
<li>Qual a pior perda que eu posso sofrer no meu patrimônio?</li>
</ul>
<p>Essas são perguntas objetivas que passam pela cabeça de todos os investidores e na tentativa de respondê-las nós vamos abordar as medidas de risco que nos permitem quantificar os pontos levantados.</p>
<div id="value-at-risk" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Value at Risk</h3>
<p>O <em>Value at Risk</em> (Valor em Risco - tradução livre) ajuda a responder a pergunta:</p>
<blockquote>
<p>Quanto eu (investidor) posso perder, em valor, para uma oscilação extrema do BOVA11 no período de 1 mês e sabendo que o valor do ativo é R$ 111.23?</p>
</blockquote>
<p>Para o horizonte de investimento de 1 mês, quanto pode ser uma oscilação <strong>extrema</strong>?
É necessário definir o que vem a ser uma variação extrema neste horizonte de investimento
Para isso vamos usar a série de retornos de 1 mês do BOVA11, pois é necessário que os retornos estejam ajustados ao horizonte de investimento definido, e vamos observar o seu histograma.</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="análise-de-risco.html#cb440-1"></a>BOVA11_monthly_rets <span class="op">%&gt;%</span></span>
<span id="cb440-2"><a href="análise-de-risco.html#cb440-2"></a><span class="st">  </span><span class="kw">chart.Histogram</span>(<span class="dt">breaks =</span> <span class="dv">30</span>,</span>
<span id="cb440-3"><a href="análise-de-risco.html#cb440-3"></a>                  <span class="dt">main =</span> <span class="st">&quot;Histograma de retornos do IBOVESPA&quot;</span>,</span>
<span id="cb440-4"><a href="análise-de-risco.html#cb440-4"></a>                  <span class="dt">show.outliers =</span> <span class="ot">TRUE</span>,</span>
<span id="cb440-5"><a href="análise-de-risco.html#cb440-5"></a>                  <span class="dt">methods =</span> <span class="st">&quot;add.normal&quot;</span>, <span class="dt">lwd =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="curso_r_financas_files/figure-html/unnamed-chunk-101-1.png" width="672" /></p>
<p>O que observamos:</p>
<ul>
<li>os maiores retornos positivos ocorrem acima de 15%</li>
<li>os maiores retornos negativos ocorrem abaixo de 10%</li>
<li>o histograma para os dados mensais não se aproxima da distribuição Normal e há alguns buracos no histograma, isso se deve ao fato da amostra ter poucos dados - note que definimos <code>breaks = 30</code></li>
</ul>
<p>Observando o histograma vemos que as perdas extremas, abaixo de 10%, ocorrem com uma frequência muito baixa, pois estão na cauda da distribução.
Sabendo que o desvio padrão de <code>BOVA11_monthly_rets</code> é aproximadamente 5%, temos que as maiores perdas estão abaixo de 2 desvios padrão.
Isso é muito ou pouco?
Para nos ajudar nessa análise vamos olhar a distribuição Normal na figura abaixo:</p>
<div class="figure">
<img src="normal3.png" alt="" />
<p class="caption">Fonte: <a href="http://www.portalaction.com.br/probabilidades/62-distribuicao-normal" class="uri">http://www.portalaction.com.br/probabilidades/62-distribuicao-normal</a></p>
</div>
<p>Com 2 desvios padrão da média (centro da distribuição) temos, aproximadamente, 5% de probabilidade para as duas caudas, como a cauda negativa é a que nos interessa, temos 2,5% de probabilidade para perdas que estão abaixo de 2 desvios padrão.</p>
<blockquote>
<p>Conclusão: A probabilidade de perdas maiores que 2 desvios padrão é de 2,5%, quando utilizamos a distribuição Normal como proxy.</p>
</blockquote>
<p>Note que estamos fazendo uma aproximação considerando a distribuição Normal para chegarmos a essa probabilidade.</p>
<p>Agora a pergunta é: dado que eu sei que a probabilidade de termos uma perda maior que 2 desvios padrão é de 2,5%, como calcular essa perda em financeiro?</p>
<p>Para isso vamos usar a função <code>qnorm</code> que dada uma probabilidade ela retorna o valor associado, considerando uma distribuição Normal.
Dado que temos a média e o desvio padrão dos retornos mensais, vamos <em>plugar</em> estes parâmetros na distribuição Normal para obter a perda associada a probabilidade de 2,5%.</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="análise-de-risco.html#cb441-1"></a>mu &lt;-<span class="st"> </span>BOVA11_monthly_rets <span class="op">%&gt;%</span></span>
<span id="cb441-2"><a href="análise-de-risco.html#cb441-2"></a><span class="st">  </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span></span>
<span id="cb441-3"><a href="análise-de-risco.html#cb441-3"></a><span class="st">  </span><span class="kw">mean</span>()</span>
<span id="cb441-4"><a href="análise-de-risco.html#cb441-4"></a>sigma &lt;-<span class="st"> </span>BOVA11_monthly_rets <span class="op">%&gt;%</span></span>
<span id="cb441-5"><a href="análise-de-risco.html#cb441-5"></a><span class="st">  </span><span class="kw">na.omit</span>() <span class="op">%&gt;%</span></span>
<span id="cb441-6"><a href="análise-de-risco.html#cb441-6"></a><span class="st">  </span><span class="kw">sd</span>()</span>
<span id="cb441-7"><a href="análise-de-risco.html#cb441-7"></a><span class="kw">qnorm</span>(<span class="fl">0.025</span>, <span class="dt">mean =</span> mu, <span class="dt">sd =</span> sigma)</span></code></pre></div>
<pre><code>## [1] -0.1015289</code></pre>
<!-- Para isso vamos usar a função `quantile` que para uma série de retornos, retorna o valor na série referente a probabilidade fornecida. -->
<!-- Por exemplo, passando a série de retornos mensais do BOVA11 e a probabilidade de 2,5% temos -->
<!-- ```{r} -->
<!-- quantile(BOVA11_monthly_rets %>% na.omit(), 0.025) -->
<!-- ``` -->
<p>Para essa amostra de retornos temos que a probabilidade de uma perda maior do que 10,15% é de 2,5%.
De posse do retorno podemos aplicar a Eq.<a href="returns.html#eq:log-price">(4.7)</a> para calcular a variação no preço para este retorno.
Sabemos que último preço de BOVA11 é R$ 111,23, dessa forma a perda é dada por:</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="análise-de-risco.html#cb443-1"></a>r_t &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.025</span>, <span class="dt">mean =</span> mu, <span class="dt">sd =</span> sigma)</span>
<span id="cb443-2"><a href="análise-de-risco.html#cb443-2"></a>P_t &lt;-<span class="st"> </span><span class="fl">111.23</span></span>
<span id="cb443-3"><a href="análise-de-risco.html#cb443-3"></a><span class="dv">1000</span> <span class="op">*</span><span class="st"> </span>P_t <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(r_t))</span></code></pre></div>
<pre><code>## [1] 10738.7</code></pre>
<p>Temos que para o horizonte de investimentos de 1 mês, a carteira com 1000 posições de BOVA11 tem um <em>Value at Risk</em> de R$ 10.738,70 com nível de confiança de 95%.
Essa é a forma que se constuma <em>ler</em> o <em>Value at Risk</em>.</p>
</div>
<div id="drawdown" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Drawdown</h3>
<p>Dado o histórico do BOVA11, qual a pior perda que eu posso sofrer no meu patrimônio? quanto tempo eu vou ficar amargando essa miséria?
Na tentativa de responder essa pergunta usamos o drawdown.
O drawdown é uma perda acumulada em uma sequência de perdas.
Como se dá isso?
As séries de retornos são bastante simétricas em torno de uma média, que é bem próxima de zero.
Dessa maneira, podemos supor que em geral os retornos sobem e descem com a mesma probabilidade.
Entretanto, existem períodos que ocorrem sequências de quedas e é isso que o drawdown mede, dada uma sequência de quedas:</p>
<ul>
<li>Quando ela começa?</li>
<li>Quando termina ?</li>
<li>Qual a magnetude da perda?</li>
</ul>
<p>No pacote <code>PerformanceAnalytics</code> tem algumas funções para trabalhar com drawdown.
Vejamos o gráfico do drawdown para os retornos diários do BOVA11 no ano de 2019.</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="análise-de-risco.html#cb445-1"></a><span class="kw">chart.Drawdown</span>(BOVA11_rets[<span class="st">&quot;2019&quot;</span>])</span></code></pre></div>
<p><img src="curso_r_financas_files/figure-html/unnamed-chunk-104-1.png" width="672" /></p>
<p>Note que no gráfico as perdas começam, há uma recuperação, mas não suficiente para reverter o estado de perda.
Quando puxamos os dados de drawdowns para o ano de 2019 (usando a função <code>table.Drawdowns</code> do <code>PerformanceAnalytics</code>) temos:</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="análise-de-risco.html#cb446-1"></a><span class="kw">table.Drawdowns</span>(BOVA11_rets[<span class="st">&quot;2019&quot;</span>])</span></code></pre></div>
<pre><code>##         From     Trough         To   Depth Length To Trough Recovery
## 1 2019-03-19 2019-05-16 2019-06-21 -0.1057     66        41       25
## 2 2019-07-11 2019-08-26 2019-10-22 -0.0937     74        33       41
## 3 2019-02-05 2019-02-11 2019-03-13 -0.0433     23         5       18
## 4 2019-11-08 2019-11-19 2019-12-04 -0.0322     17         7       10
## 5 2019-01-28 2019-01-28 2019-02-01 -0.0224      5         1        4</code></pre>
<p>Note que o maior drawdown gera uma perda de 10,57%, com uma duração de 66 dias, do começo até zerar a perda, a pior ponto acontece em 41 dias e após este ponto são 25 dias de recuperação.</p>
</div>
<div id="short-fall-risk" class="section level3">
<h3><span class="header-section-number">5.3.3</span> Short-Fall Risk</h3>
<p>Vimos como quantificar a perda dado um nível de risco associado a uma probabilidade no cálculo do VaR, agora vamos inverter a análise, e vamos calcular a probabilidade de ter uma perda maior que um determinado valor.
Ou seja, como calcular a probabilidade de um retorno cair abaixo de 5%?</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="análise-de-risco.html#cb448-1"></a><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(BOVA11_rets <span class="op">&lt;</span><span class="st"> </span><span class="fl">-0.05</span>,</span>
<span id="cb448-2"><a href="análise-de-risco.html#cb448-2"></a>    <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(BOVA11_rets)</span></code></pre></div>
<pre><code>## [1] 0.1603421</code></pre>
<p>Para os retornos diários temos uma probabilidade de 0,16% de termos retornos menores que 5%.</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="análise-de-risco.html#cb450-1"></a><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(BOVA11_monthly_rets <span class="op">&lt;</span><span class="st"> </span><span class="fl">-0.05</span>,</span>
<span id="cb450-2"><a href="análise-de-risco.html#cb450-2"></a>    <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(BOVA11_monthly_rets)</span></code></pre></div>
<pre><code>## [1] 12.08791</code></pre>
<p>Os retornos mensais apresentam uma probabilidade de 12,09% de probabilidade para retornos menores que 5%.</p>
</div>
</div>
<div id="análise-em-janela-móvel" class="section level2">
<h2><span class="header-section-number">5.4</span> Análise em Janela Móvel</h2>
<p>Análise em janela móvel é útil para a avaliação da dinâmica temporal dos dados.
Por exemplo, temos a série de retornos do IBOVESPA de 2010 a 2019 e podemos calcular a média e o desvio padrão para essa amostra.</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="análise-de-risco.html#cb452-1"></a><span class="kw">c</span>(</span>
<span id="cb452-2"><a href="análise-de-risco.html#cb452-2"></a>  <span class="dt">mean =</span> IBOVESPA_rets <span class="op">%&gt;%</span><span class="st"> </span>na.omit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mean</span>(),</span>
<span id="cb452-3"><a href="análise-de-risco.html#cb452-3"></a>  <span class="dt">sd =</span> IBOVESPA_rets <span class="op">%&gt;%</span><span class="st"> </span>na.omit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sd</span>()</span>
<span id="cb452-4"><a href="análise-de-risco.html#cb452-4"></a>)</span></code></pre></div>
<pre><code>##         mean           sd 
## 0.0001459989 0.0140487672</code></pre>
<p>Uma pergunta que podemos fazer é, como se comporta a média e o desvio em uma janela móvel de 21 dias (tipicamente 1 mês em dias úteis).</p>
<p>Vamos usar a função <code>rollmean</code> onde passamos a série e o tamanho da janela e ela retorna uma série com as médias para as janelas contíguas de 21 dias.</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="análise-de-risco.html#cb454-1"></a><span class="kw">rollmean</span>(IBOVESPA_rets, <span class="dv">21</span>) <span class="op">%&gt;%</span></span>
<span id="cb454-2"><a href="análise-de-risco.html#cb454-2"></a><span class="st">  </span><span class="kw">autoplot</span>() <span class="op">+</span></span>
<span id="cb454-3"><a href="análise-de-risco.html#cb454-3"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> IBOVESPA_rets <span class="op">%&gt;%</span><span class="st"> </span>na.omit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mean</span>(), <span class="dt">colour =</span> <span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="curso_r_financas_files/figure-html/unnamed-chunk-109-1.png" width="672" /></p>
<p>Marcando em vermelho a média da amostra completa, é interessante ver que há uma grande dispersão em torno desse valor e não há tendência clara de longo prazo, o que faz sentido (porque?).</p>
<p>A mesma análise pode ser realizada com o desvio padrão.
Neste caso usamos a função <code>rollapply</code> que recebe a série de retornos, o tamanho da janela e a função a ser aplicada a cada janela, aqui usaremos a função <code>sd</code> para cálculo do desvio padrão.</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="análise-de-risco.html#cb455-1"></a><span class="kw">rollapply</span>(IBOVESPA_rets, <span class="dv">21</span>, sd) <span class="op">%&gt;%</span></span>
<span id="cb455-2"><a href="análise-de-risco.html#cb455-2"></a><span class="st">  </span><span class="kw">autoplot</span>() <span class="op">+</span></span>
<span id="cb455-3"><a href="análise-de-risco.html#cb455-3"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> IBOVESPA_rets <span class="op">%&gt;%</span><span class="st"> </span>na.omit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sd</span>(), <span class="dt">colour =</span> <span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="curso_r_financas_files/figure-html/unnamed-chunk-110-1.png" width="672" /></p>
<p>Curioso ver que em 2011 e 2014/2015 tivemos picos mais pronunciados no desvio padrão, indicando momentos de maior volatilidade.</p>
</div>
<div id="túnel-de-volatilidade" class="section level2">
<h2><span class="header-section-number">5.5</span> Túnel de Volatilidade</h2>
<p>Complementando a análise em janela móvel para os retornos, podemos também construir um túnel de volatilidade (ou envelope de volatilidade) que é útil para uma análise qualitativa dos retornos em conjunto com o desvio padrão em janela móvel.</p>
<p>No gráfico abaixo fazemos o gráfico dos retornos com o túnel de volatilidade e fica bem evidente que nos períodos de 2011 e 2014/2015 tivemos umas aglomerações de retornos, indicando um período de crise onde retornos mais extremos, bastante distantes da média, podem ocorrer.</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="análise-de-risco.html#cb456-1"></a><span class="kw">plot</span>(<span class="kw">index</span>(IBOVESPA_rets), <span class="kw">coredata</span>(IBOVESPA_rets),</span>
<span id="cb456-2"><a href="análise-de-risco.html#cb456-2"></a>     <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb456-3"><a href="análise-de-risco.html#cb456-3"></a>     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb456-4"><a href="análise-de-risco.html#cb456-4"></a>     <span class="dt">cex.axis =</span> <span class="fl">.7</span>,</span>
<span id="cb456-5"><a href="análise-de-risco.html#cb456-5"></a>     <span class="dt">lwd =</span> <span class="dv">1</span>,</span>
<span id="cb456-6"><a href="análise-de-risco.html#cb456-6"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Date&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Retorno&quot;</span>,</span>
<span id="cb456-7"><a href="análise-de-risco.html#cb456-7"></a>     <span class="dt">main =</span> <span class="st">&quot;Retorno diário do IBOVESPA com intervalo de confiança de 2 desvios&quot;</span>)</span>
<span id="cb456-8"><a href="análise-de-risco.html#cb456-8"></a>volatility &lt;-<span class="st"> </span><span class="kw">rollapply</span>(IBOVESPA_rets, <span class="dv">21</span>, sd)</span>
<span id="cb456-9"><a href="análise-de-risco.html#cb456-9"></a><span class="kw">lines</span>(<span class="kw">index</span>(volatility), <span class="kw">coredata</span>(volatility) <span class="op">*</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb456-10"><a href="análise-de-risco.html#cb456-10"></a><span class="kw">lines</span>(<span class="kw">index</span>(volatility), <span class="op">-</span><span class="kw">coredata</span>(volatility) <span class="op">*</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="curso_r_financas_files/figure-html/unnamed-chunk-111-1.png" width="672" /></p>
</div>
<div id="comparando-ativos" class="section level2">
<h2><span class="header-section-number">5.6</span> Comparando Ativos</h2>
<p>Até aqui realizamos a análise de risco para apenas um ativo.
Agora vamos utilizar esta análise univariada e vamos aplicar a diversos ativos para entender como diferentes ativos podem ser comparados entre si.
Vamos utilizar uma série gráficos aqui que permitem uma análise conjunta dos ativos de forma que façamos uma análise de risco comparando os ativos entre si.</p>
<div id="comparação-de-risco-e-retorno-de-diversos-ativos-gráfico-de-risco-x-retorno" class="section level3">
<h3><span class="header-section-number">5.6.1</span> Comparação de risco e retorno de diversos ativos: gráfico de risco x retorno</h3>
<p>Vamos começar o gráfico risco x retorno, onde no eixo x é o risco e no y os retornos.
Os passos são</p>
<ul>
<li>baixar as séries de preços dos ativos com o <code>quantmod</code></li>
<li>juntar as séries de diferentes ativos em um único objeto <code>xts</code></li>
<li>criar as séries mensais e calcular os retornos</li>
<li>calcular médias e desvios padrão para cada um dos ativos</li>
<li>montar o gráfico risco x retorno</li>
</ul>
<div id="baixando-as-séries-de-preços" class="section level4">
<h4><span class="header-section-number">5.6.1.1</span> Baixando as séries de preços</h4>
<p>As séries dos ativos contidas em <code>symbols</code> são baixadas e depois juntadas com a chamada <code>reduce(merge)</code>.
Essa é uma passagem tricky que vale a pena ser executada passo a passo para que seja bem compreendida.</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="análise-de-risco.html#cb457-1"></a>symbols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;BOVA11.SA&quot;</span>, <span class="st">&quot;SMAL11.SA&quot;</span>, <span class="st">&quot;SPXI11.SA&quot;</span>, <span class="st">&quot;PETR4.SA&quot;</span>, <span class="st">&quot;VALE3.SA&quot;</span>, <span class="st">&quot;B3SA3.SA&quot;</span>, <span class="st">&quot;ABEV3.SA&quot;</span>, <span class="st">&quot;ITUB4.SA&quot;</span>, <span class="st">&quot;VVAR3.SA&quot;</span>)</span>
<span id="cb457-2"><a href="análise-de-risco.html#cb457-2"></a>prices &lt;-<span class="st"> </span><span class="kw">getSymbols</span>(symbols, <span class="dt">from =</span> <span class="st">&quot;2016-01-01&quot;</span>,</span>
<span id="cb457-3"><a href="análise-de-risco.html#cb457-3"></a>                     <span class="dt">to =</span> <span class="st">&quot;2019-12-31&quot;</span>,</span>
<span id="cb457-4"><a href="análise-de-risco.html#cb457-4"></a>                     <span class="dt">auto.assign =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb457-5"><a href="análise-de-risco.html#cb457-5"></a><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">Ad</span>(<span class="kw">get</span>(.))) <span class="op">%&gt;%</span></span>
<span id="cb457-6"><a href="análise-de-risco.html#cb457-6"></a><span class="st">  </span><span class="kw">reduce</span>(merge) <span class="op">%&gt;%</span></span>
<span id="cb457-7"><a href="análise-de-risco.html#cb457-7"></a><span class="st">  `</span><span class="dt">colnames&lt;-</span><span class="st">`</span>(symbols)</span></code></pre></div>
<p>Obtidas as séries vamos ver o que temos em mãos.</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="análise-de-risco.html#cb458-1"></a><span class="kw">plot</span>(prices, <span class="dt">legend.loc =</span> <span class="st">&quot;topleft&quot;</span>)</span></code></pre></div>
<p><img src="curso_r_financas_files/figure-html/unnamed-chunk-113-1.png" width="672" /></p>
<p>Nada demais, séries diferentes com diferentes ordens de grandeza, o que prejudica a avaliação.</p>
</div>
<div id="calculando-dados-mensais" class="section level4">
<h4><span class="header-section-number">5.6.1.2</span> Calculando dados mensais</h4>
<p>Usando a função <code>to.monthly</code> para obter as séries de preços mensais.</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="análise-de-risco.html#cb459-1"></a>prices_monthly &lt;-<span class="st"> </span><span class="kw">to.monthly</span>(prices, <span class="dt">indexAt =</span> <span class="st">&quot;lastof&quot;</span>, <span class="dt">OHLC =</span> <span class="ot">FALSE</span>)</span>
<span id="cb459-2"><a href="análise-de-risco.html#cb459-2"></a><span class="kw">head</span>(prices_monthly)</span></code></pre></div>
<pre><code>##            BOVA11.SA SMAL11.SA SPXI11.SA PETR4.SA  VALE3.SA  B3SA3.SA ABEV3.SA
## 2016-01-31     39.19     37.71     78.32 4.490080  8.315054  8.961099 16.52255
## 2016-02-29     41.45     39.65     79.03 4.768392 10.102961 10.148924 15.72897
## 2016-03-31     48.64     44.25     75.37 7.709209 12.960191 13.406712 16.76330
## 2016-04-30     52.15     46.65     72.21 9.490397 16.843971 15.005033 17.28939
## 2016-05-31     47.02     44.26     76.83 7.458729 12.164614 13.986295 17.03972
## 2016-06-30     49.90     48.45     68.58 8.738958 13.918304 15.813653 16.98622
##            ITUB4.SA VVAR3.SA
## 2016-01-31 12.00738 1.232770
## 2016-02-29 12.23606 2.236881
## 2016-03-31 15.04968 2.405890
## 2016-04-30 15.86267 2.953283
## 2016-05-31 14.02979 2.585365
## 2016-06-30 14.64589 3.082551</code></pre>
<p>Obtidas as séries de preços mensais vamos seguir com o cálculo dos retornos usando a já conhecida <code>Return.calculate</code>.</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="análise-de-risco.html#cb461-1"></a>prices_monthly_rets &lt;-<span class="st"> </span><span class="kw">Return.calculate</span>(prices_monthly, <span class="st">&quot;log&quot;</span>)</span>
<span id="cb461-2"><a href="análise-de-risco.html#cb461-2"></a><span class="kw">head</span>(prices_monthly_rets)</span></code></pre></div>
<pre><code>##              BOVA11.SA   SMAL11.SA    SPXI11.SA    PETR4.SA   VALE3.SA
## 2016-01-31          NA          NA           NA          NA         NA
## 2016-02-29  0.05606632  0.05016571  0.009024516  0.06013862  0.1947609
## 2016-03-31  0.15995831  0.10976437 -0.047418157  0.48040645  0.2490539
## 2016-04-30  0.06967800  0.05281760 -0.042830831  0.20786486  0.2621104
## 2016-05-31 -0.10355118 -0.05259168  0.062016688 -0.24089542 -0.3254615
## 2016-06-30  0.05944800  0.09045107 -0.113594239  0.15840594  0.1346736
##               B3SA3.SA     ABEV3.SA    ITUB4.SA    VVAR3.SA
## 2016-01-31          NA           NA          NA          NA
## 2016-02-29  0.12447481 -0.049222058  0.01886628  0.59581881
## 2016-03-31  0.27838779  0.063687794  0.20696912  0.07283741
## 2016-04-30  0.11263020  0.030900753  0.05261202  0.20499754
## 2016-05-31 -0.07030776 -0.014545521 -0.12278562 -0.13305074
## 2016-06-30  0.12279576 -0.003144956  0.04297710  0.17589080</code></pre>
</div>
<div id="calculando-média-e-desvio-padrão" class="section level4">
<h4><span class="header-section-number">5.6.1.3</span> Calculando média e desvio padrão</h4>
<p>Tendo um objeto com todos os retornos mensais vamos calcular a média para cada ativo com <code>colMeans</code> que calcula a média de cada coluna de uma matriz (em nosso caso um objeto <code>xts</code>).</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="análise-de-risco.html#cb463-1"></a>exp_returns &lt;-<span class="st"> </span><span class="kw">colMeans</span>(prices_monthly_rets, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb463-2"><a href="análise-de-risco.html#cb463-2"></a>exp_returns</span></code></pre></div>
<pre><code>##   BOVA11.SA   SMAL11.SA   SPXI11.SA    PETR4.SA    VALE3.SA    B3SA3.SA 
## 0.022195289 0.027360844 0.011658452 0.040536915 0.038657794 0.032656128 
##    ABEV3.SA    ITUB4.SA    VVAR3.SA 
## 0.002599821 0.023515049 0.046892935</code></pre>
<p>O cálculo do desvio padrão utiliza a função <code>StdDev</code> do pacote <code>PerformanceAnalytics</code>.</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="análise-de-risco.html#cb465-1"></a>exp_risk &lt;-<span class="st"> </span><span class="kw">StdDev</span>(prices_monthly_rets)</span>
<span id="cb465-2"><a href="análise-de-risco.html#cb465-2"></a>exp_risk</span></code></pre></div>
<pre><code>##         BOVA11.SA  SMAL11.SA  SPXI11.SA  PETR4.SA VALE3.SA   B3SA3.SA
## StdDev 0.05495577 0.05394365 0.05235481 0.1269872 0.113819 0.08488673
##          ABEV3.SA   ITUB4.SA  VVAR3.SA
## StdDev 0.06119064 0.07817455 0.1760825</code></pre>
<p>Com isso fechamos os indicadores de risco e retorno para cada um dos ativos.</p>
</div>
<div id="construindo-o-gráfico-risco-x-retorno" class="section level4">
<h4><span class="header-section-number">5.6.1.4</span> Construindo o gráfico risco x retorno</h4>
<p>A parte mais fácil é construir os gráficos e utilizar os nomes dos ativos para identificá-los facilmente no gráfico.</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="análise-de-risco.html#cb467-1"></a><span class="kw">plot</span>(exp_risk, exp_returns, </span>
<span id="cb467-2"><a href="análise-de-risco.html#cb467-2"></a>     <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.2</span>),</span>
<span id="cb467-3"><a href="análise-de-risco.html#cb467-3"></a>     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="fl">0.0</span>, <span class="fl">0.05</span>),</span>
<span id="cb467-4"><a href="análise-de-risco.html#cb467-4"></a>     <span class="dt">pch =</span> <span class="dv">16</span>)</span>
<span id="cb467-5"><a href="análise-de-risco.html#cb467-5"></a><span class="kw">text</span>(<span class="dt">x =</span> exp_risk,</span>
<span id="cb467-6"><a href="análise-de-risco.html#cb467-6"></a>     <span class="dt">y =</span> exp_returns,</span>
<span id="cb467-7"><a href="análise-de-risco.html#cb467-7"></a>     <span class="dt">labels =</span> <span class="kw">colnames</span>(exp_risk),</span>
<span id="cb467-8"><a href="análise-de-risco.html#cb467-8"></a>     <span class="dt">pos=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="curso_r_financas_files/figure-html/unnamed-chunk-118-1.png" width="672" /></p>
<p>Interessante aqui é ver uma <em>small cap</em> (ação de empresa com menor tamanho de mercado), VVAR3, dispontando com a maior risco e retorno, seguida de PETR4 e VALE3, duas consagradas blueships.
Outra coisa curiosa, o SMALL11 (ETF de small caps) com um risco ligeiramente menor que BOVA11 e com maior retorno.</p>
</div>
</div>
<div id="gráfico-boxplot-com-retorno-dos-ativos" class="section level3">
<h3><span class="header-section-number">5.6.2</span> Gráfico boxplot com retorno dos ativos</h3>
<p>O boxplot é uma forma de visualizar a dispersão dos dados e permite ainda a avaliação de pontos extremos na amostra, os <em>outliers</em>.
Dado que possuimos uma amostra de retornos para cada ativo, podemos calcular um boxplot para cada ativo.
Colocando tudo no mesmo gráfico nos permite comparar como os retornos dos ativos estão distribuidos.</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="análise-de-risco.html#cb468-1"></a>prices_monthly_rets <span class="op">%&gt;%</span></span>
<span id="cb468-2"><a href="análise-de-risco.html#cb468-2"></a><span class="st">  </span><span class="kw">data.frame</span>(<span class="dt">Date =</span> <span class="kw">index</span>(.)) <span class="op">%&gt;%</span></span>
<span id="cb468-3"><a href="análise-de-risco.html#cb468-3"></a><span class="st">  </span><span class="kw">remove_rownames</span>() <span class="op">%&gt;%</span></span>
<span id="cb468-4"><a href="análise-de-risco.html#cb468-4"></a><span class="st">  </span><span class="kw">gather</span>(Symbol, Returns, <span class="op">-</span>Date) <span class="op">%&gt;%</span></span>
<span id="cb468-5"><a href="análise-de-risco.html#cb468-5"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Symbol, <span class="dt">y =</span> Returns)) <span class="op">+</span></span>
<span id="cb468-6"><a href="análise-de-risco.html#cb468-6"></a><span class="st">  </span><span class="kw">geom_boxplot</span>()</span></code></pre></div>
<p><img src="curso_r_financas_files/figure-html/unnamed-chunk-119-1.png" width="672" /></p>
</div>
<div id="gráfico-violinplot-com-as-distribuições-de-retornos-dos-ativos" class="section level3">
<h3><span class="header-section-number">5.6.3</span> Gráfico violinplot com as distribuições de retornos dos ativos</h3>
<p>O <em>violinplot</em> é muito semelhante ao boxplot.
É um pouco mais <em>fancy</em> apesar de não deixar clara a existência de <em>outliers</em>, mas impressiona em um ppt.
Brincadeiras a parte ele apresenta uma distribuição continua para cada ativo, o que permite identificar a simetria das distribuições dos retornos.</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="análise-de-risco.html#cb469-1"></a>prices_monthly_rets <span class="op">%&gt;%</span></span>
<span id="cb469-2"><a href="análise-de-risco.html#cb469-2"></a><span class="st">  </span><span class="kw">data.frame</span>(<span class="dt">Date =</span> <span class="kw">index</span>(.)) <span class="op">%&gt;%</span></span>
<span id="cb469-3"><a href="análise-de-risco.html#cb469-3"></a><span class="st">  </span><span class="kw">remove_rownames</span>() <span class="op">%&gt;%</span></span>
<span id="cb469-4"><a href="análise-de-risco.html#cb469-4"></a><span class="st">  </span><span class="kw">gather</span>(Symbol, Returns, <span class="op">-</span>Date) <span class="op">%&gt;%</span></span>
<span id="cb469-5"><a href="análise-de-risco.html#cb469-5"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Symbol, <span class="dt">y =</span> Returns)) <span class="op">+</span></span>
<span id="cb469-6"><a href="análise-de-risco.html#cb469-6"></a><span class="st">  </span><span class="kw">geom_violin</span>(<span class="dt">fill =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="curso_r_financas_files/figure-html/unnamed-chunk-120-1.png" width="672" /></p>
</div>
<div id="correlação-entre-séries-de-retornos" class="section level3">
<h3><span class="header-section-number">5.6.4</span> Correlação entre séries de retornos</h3>
<p>Concluindo a parte multivariada precisamos calcular a correlação entre os ativos, não poderia ficar de fora.
A matriz de correlação é obtida com a função <code>cor</code> que retorna uma matrix quadrada com as correlações entre cada um dos pares de ativos e 1 na diagonal principal, como é uma matriz de correlação.</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="análise-de-risco.html#cb470-1"></a><span class="kw">cor</span>(prices_monthly_rets <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">na.omit</span>())</span></code></pre></div>
<pre><code>##            BOVA11.SA  SMAL11.SA   SPXI11.SA   PETR4.SA   VALE3.SA   B3SA3.SA
## BOVA11.SA  1.0000000  0.8719722 -0.47764813  0.8684556  0.4678069  0.7619350
## SMAL11.SA  0.8719722  1.0000000 -0.51911630  0.6452371  0.3061980  0.6321611
## SPXI11.SA -0.4776481 -0.5191163  1.00000000 -0.4666173 -0.1148997 -0.4768917
## PETR4.SA   0.8684556  0.6452371 -0.46661726  1.0000000  0.4813710  0.6735395
## VALE3.SA   0.4678069  0.3061980 -0.11489970  0.4813710  1.0000000  0.2238908
## B3SA3.SA   0.7619350  0.6321611 -0.47689171  0.6735395  0.2238908  1.0000000
## ABEV3.SA   0.4264350  0.4600609 -0.01728933  0.2039109 -0.0182789  0.3576270
## ITUB4.SA   0.9113159  0.7489049 -0.47870662  0.7764730  0.3262517  0.6980960
## VVAR3.SA   0.5137772  0.5543491 -0.32382206  0.2988384  0.2077724  0.4305646
##              ABEV3.SA   ITUB4.SA   VVAR3.SA
## BOVA11.SA  0.42643495  0.9113159  0.5137772
## SMAL11.SA  0.46006094  0.7489049  0.5543491
## SPXI11.SA -0.01728933 -0.4787066 -0.3238221
## PETR4.SA   0.20391093  0.7764730  0.2988384
## VALE3.SA  -0.01827890  0.3262517  0.2077724
## B3SA3.SA   0.35762698  0.6980960  0.4305646
## ABEV3.SA   1.00000000  0.3439020  0.3857068
## ITUB4.SA   0.34390196  1.0000000  0.3900220
## VVAR3.SA   0.38570681  0.3900220  1.0000000</code></pre>
<p>A matriz de covariância é calculada com a função <code>cov</code>.</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="análise-de-risco.html#cb472-1"></a><span class="kw">cov</span>(prices_monthly_rets <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">na.omit</span>())</span></code></pre></div>
<pre><code>##              BOVA11.SA    SMAL11.SA     SPXI11.SA     PETR4.SA      VALE3.SA
## BOVA11.SA  0.003020137  0.002584975 -1.374289e-03  0.006060672  0.0029261381
## SMAL11.SA  0.002584975  0.002909918 -1.466093e-03  0.004419971  0.0018799989
## SPXI11.SA -0.001374289 -0.001466093  2.741026e-03 -0.003102253 -0.0006846843
## PETR4.SA   0.006060672  0.004419971 -3.102253e-03  0.016125738  0.0069575226
## VALE3.SA   0.002926138  0.001879999 -6.846843e-04  0.006957523  0.0129547701
## B3SA3.SA   0.003554439  0.002894729 -2.119416e-03  0.007260435  0.0021631714
## ABEV3.SA   0.001434007  0.001518591 -5.538853e-05  0.001584475 -0.0001273063
## ITUB4.SA   0.003915143  0.003158148 -1.959257e-03  0.007708175  0.0029029070
## VVAR3.SA   0.004971693  0.005265503 -2.985239e-03  0.006682091  0.0041640788
##               B3SA3.SA      ABEV3.SA     ITUB4.SA     VVAR3.SA
## BOVA11.SA  0.003554439  1.434007e-03  0.003915143  0.004971693
## SMAL11.SA  0.002894729  1.518591e-03  0.003158148  0.005265503
## SPXI11.SA -0.002119416 -5.538853e-05 -0.001959257 -0.002985239
## PETR4.SA   0.007260435  1.584475e-03  0.007708175  0.006682091
## VALE3.SA   0.002163171 -1.273063e-04  0.002902907  0.004164079
## B3SA3.SA   0.007205756  1.857612e-03  0.004632552  0.006435678
## ABEV3.SA   0.001857612  3.744295e-03  0.001645073  0.004155837
## ITUB4.SA   0.004632552  1.645073e-03  0.006111261  0.005368719
## VVAR3.SA   0.006435678  4.155837e-03  0.005368719  0.031005042</code></pre>
<p>A função <code>chart.Correlation</code> do <code>PerformanceAnalytics</code> traz um gráfico bem interessante e completo da correlação entre os ativos.</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="análise-de-risco.html#cb474-1"></a><span class="kw">chart.Correlation</span>(prices_monthly_rets)</span></code></pre></div>
<p><img src="curso_r_financas_files/figure-html/unnamed-chunk-123-1.png" width="672" />
Onde além dos valores de correlação também traz os níveis de significância de cada estivativa.
Note que ABEV3 e VALE3 apresentam uma correlação muito baixa entre si, o que veremos no próximo capítulo, é uma boa característica quando falamos em diversificação.</p>
</div>
</div>
<div id="exercícios---análise-de-risco" class="section level2">
<h2><span class="header-section-number">5.7</span> Exercícios - Análise de Risco</h2>
<ol style="list-style-type: decimal">
<li>Escolher 1 série de preços de ações, ETFs ou Índices, calcular:</li>
</ol>
<ul>
<li>Retornos diários logaritmicos</li>
<li>Volatilidade em janela móvel</li>
<li>Gráfico de túnel de volatilidade</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Para a série de retornos diários logaritmicos</li>
</ol>
<ul>
<li>Fazer o gráfico do histograma</li>
<li>Com a média e variância da amostra fazer o gráfico da densidade de probabilidade da distribuição normal. Comparar os gráficos. O histograma da amostra <em>parece</em> com uma distribuição normal?</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="returns.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="análise-de-carteiras.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["curso_r_financas.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
